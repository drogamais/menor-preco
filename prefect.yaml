name: mp-feeder-project
prefect-version: 3.6.1

# --- SEÇÃO PULL: USANDO GIT CLONE ---
pull:
  - prefect.deployments.steps.git_clone:
      # COLOQUE AQUI A URL HTTPS DO SEU REPOSITÓRIO (ex: github.com/usuario/repo.git)
      repository: https://github.com/drogamais/menor-preco.git
      branch: prefect_test
      # Puxa o token do bloco Secret que você criou no passo 1
      access_token: "{{ prefect.blocks.secret.github-token }}"

# --- SEUS DEPLOYMENTS ---
deployments:
- name: mp-feeder-etl-diario
  version: null
  tags:
    - etl
    - producao
  description: Roda o ETL do Menor Preço (1 lote por execucao)

  schedule:
    cron: "0 5 * * *"
    timezone: "America/Sao_Paulo"

  job_variables:
    env:
      PYTHONUTF8: "1"

  # O entrypoint é relativo à raiz do repositório clonado
  entrypoint: mp_feeder_flow.py:mp_feeder_flow

  work_pool:
    name: etl-agent-pool

  runtime:
    type: subprocess
    config:
      # IMPORTANTE: Removi o 'cwd'. O Prefect rodará na pasta clonada automaticamente.
      
      # Mantemos o Python fixo do seu ambiente virtual (isso não muda)
      python: C:\Automacao\menor-preco\venv\Scripts\python.exe