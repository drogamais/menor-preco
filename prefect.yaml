name: mp-feeder-project
prefect-version: 3.6.1

pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/drogamais/menor-preco.git
      branch: prefect_test
      
  # ADICIONE ISTO:
  # Instala as dependências em um venv temporário
  - prefect.deployments.steps.pip_install_requirements:
      requirements_file: requirements.txt 
      # (Opcional, mas bom: usa o venv do agente para criar o venv)
      stream_output: true 

deployments:
- name: mp-feeder-etl-diario
  version: null
  tags:
    - etl
    - producao
  description: Roda o ETL do Menor Preço (1 lote por execucao)

  schedule:
    cron: "0 5 * * *"
    timezone: "America/Sao_Paulo"

  entrypoint: mp_feeder_flow.py:mp_feeder_flow

  work_pool:
    name: etl-agent-pool

  # REMOVA O 'runtime:' INTEIRO.
  # O Prefect agora gerencia o ambiente automaticamente
  # runtime:
  #   type: subprocess
  #   config:
  #     python: "C:/Automacao/menor-preco/venv/Scripts/python.exe"