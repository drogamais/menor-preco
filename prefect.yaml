name: mp-feeder-project
prefect-version: 3.6.1

# ----------------------------------------------------
# ⬇ CORREÇÃO 1: Bloco 'pull' em sintaxe longa ⬇
# ----------------------------------------------------
pull:
  - step: prefect.deployments.steps.git_clone
    # O 'inputs:' foi removido, as chaves estão no mesmo nível
    repository: https://github.com/drogamais/menor-preco.git
    branch: prefect_test

# ----------------------------------------------------
# ⬇ CORREÇÃO 2: Bloco 'build' em sintaxe longa ⬇
# ----------------------------------------------------
build:
  - step: prefect.deployments.steps.run_shell_script
    # O 'inputs:' foi removido, as chaves estão no mesmo nível
    shell: "cmd"
    script: "python -m venv .venv && .venv\\Scripts\\python.exe -m pip install --upgrade pip wheel && .venv\\Scripts\\python.exe -m pip install -r requirements.txt"

# ----------------------------------------------------
# ⬆ Fim das correções ⬆
# ----------------------------------------------------

deployments:
- name: mp-feeder-etl-diario
  version: null
  tags:
  - etl
  - producao
  description: Roda o ETL do Menor Preco (1 lote por execucao)
  schedule:
    cron: "0 5 * * *"
    timezone: "America/Sao_Paulo"
  entrypoint: mp_feeder_flow.py:mp_feeder_flow
  work_pool:
    name: etl-agent-pool
  
  runtime:
    type: subprocess
    config:
      # Agora este caminho funciona, porque o 'build' acabou de criar
      python: "./.venv/Scripts/python.exe"
      env:
        PYTHONUTF8: "1"